---
- hosts: all
  roles:
    - bdellegrazie.ansible-role-serverspec_test_dependencies
    - geerlingguy.java
    - role_under_test
  pre_tasks:
    - name: "Workaround for packaging bug https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=863199#23"
      become: true
      become_user: root
      file:
        path: /usr/share/man/man1
        owner: root
        group: root
        mode: "u=rwx,go=rx"
        recurse: true
        state: directory
      when: ansible_distribution == 'Ubuntu' and ansible_distribution_version == '18.04'

    - name: "httpserver test config"
      become: true
      become_user: root
      copy:
        dest: /etc/jmx_exporter_httpserver.yml
        group: root
        mode: "u=wr,go=r"
        owner: root
        content: |
            ---
            hostPort: localhost:5555
            rules:
              - pattern: ".*"
